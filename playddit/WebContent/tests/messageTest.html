<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<script src="../js/jquery-3.5.1.min.js"></script>
<style>
input[type=text]{
	width : 300px;
}
</style>
<script>
$(function(){
	
	$('#getMessage').on('click', function(){
		getMessage();
	})
	
	$('#getAudiences').on('click', function(){
		getAudiences();
	})
	
	$('#audiences').on('click', '.btn', function(){
		var user = $('input[name=user]').val();
		var audience = $(this).attr('audience');
		getMessage(user,audience);
	})
	
})

getAudiences = function(){
	var user_id = $('input[name=user]').val();
	$('#audiences').empty();
	$('#result').empty();
	
	$.ajax({
		url : '/playddit/message/getAudiences.do',
		type : 'post',
		data : {'user_id' : user_id},
		success : function(res){
			$.each(res, function(i,v){
				var id = v.user_id;
				var nickname = v.user_nickname;
				$('#audiences').append('<button class="btn" audience='+id+'>'+nickname+'</button>');
			})
		},
		error : function(xhr){
			alert("status : " + xhr.status);
		},
		dataType : 'json'
	})
}

getMessage = function(user, audience){
	$('#result').empty();

	$.ajax({
		url : '/playddit/message/getMessage.do',
		type : 'post',
		data : {'user' : user, 'audience' : audience},
		success : function(res){
			var message = "";
			$.each(res, function(i,v){
				message += '<p>' + v.sender + '->' + v.receiver;
				message += '<br>'+ v.content + '<br>' + v.sentdate;
				message += '</p>';
			})
			$('#result').append(message);
		},
		error : function(xhr){
			alert("status : " + xhr.status);
		},
		dataType : 'json'
	})
}

</script>
</head>
<body>
	<div>
		예제 아이디<br>
		psh40963@naver.com<br>expedition1205@gmail.com<br>chdnjs7610@gmail.com
		<br>내 아이디<input type="text" name="user">
		<br><button id="getAudiences">메시지 주고받은 사람들 불러오기</button>
		<br><br>
		<div id="audiences"></div>
	</div>
	<div id="result">
	</div>
</body>
</html>