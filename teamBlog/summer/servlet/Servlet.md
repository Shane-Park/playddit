# Servlet ?

## 서블릿이란

- Server Program + let(웹 서버에서 실행되는 작은 프로그램 단위)의 합성어
- Server + Applet

의견이 나뉘지만 결국 

### 클라이언트 요청을 처리하고 그 결과를 다시 클라이언트에게 전송하는 Servlet 클래스의 구현 규칙을 지킨 자바 프로그램

그러니까

### 클라이언트의 HTTP요청에 대해 특정 기능을 수행, HTML문서 생성 등의 응답을 하는 인터넷 서버 프로그램

정도로 이해하면 되겠다.

물론 자바와 관련이 있으므로 JDK가 필요하다. 

즉, 자바 API와 이를 동작시키는 JVM이 필요하다는 뜻이다.

## 서블릿 컨테이너

그냥 서버에 서블릿을 만들어서 위치해 둔다고 클라이언트의 Request/Response를 처리해줄리가 없다.

결론적으로 서블릿을 관리해주는 놈을 서블릿 컨테이너라고 한다. 

서블릿 컨테이너는 서블릿의 생명주기를 관리하고 요청에 따른 스레드를 생성해준다. 

또, 클라이언트의 Request를 받아주고 Response를 보낼 수 있게 웹 서버와 소켓을 만들어서 통신을 해준다.

- 통신 지원
서블릿과 웹 서버가 통신할 수 있는 손쉬운 방법을 제공한다. 
우리가 통신을 할 때 소켓을 만들고, 특정 포트를 리스닝하고, 연결 요청이 들어오면 스트림을 생성해서 요청을 받는다고 알고있는데, 이 과정을 서블릿 컨테이너가 대신 해주는 것이다.
서블릿 컨테이너는 이런 통신 과정을 API로 제공하고 있기 때문에 우리가 쉽게 사용할 수 있다.
- 생명주기 관리
서블릿 컨테이너가 기동되는 순간 서블릿 클래스를 로딩해서 인스턴스화하고, 초기화 메서드를 호출하고, 요청이 들어오면 적절한 서블릿 메서드를 찾아서 호출한다.
서블릿의 생명이 다하는 순간 가비지 컬렉션을 진행한다.
- 멀티 스레딩 관리
서블릿 컨테이너는 해당 서블릿의 요청이 들어오면 스레드를 생성해서 작업을 수행한다.
즉, 동시에 여러 요청이 들어온다면 멀티스레딩 환경으로 동시다발적인 작업을 관리한다.
- 선언적인 보안관리
서블릿 컨테이너는 보안 관련된 기능을 지원한다.
따라서 서블릿 코드 안에 보안 관련된 메서드를 구현하지 않아도 된다.
- JSP지원

 

## 톰캣

톰캣은 서블릿 컨테이너이다.
톰캣은 웹 서버와 연동하여 실행할 수 있는 자바 환경을 제공하여 자바서버페이지(JSP)와 자바 서블릿이 실행될 수 있는 환경을 제공하고 있다.
톰캣은 관리툴을 통해 설정을 변경할 수 있지만, XML 파일을 편집하여 설정할 수도있다.
그리고 톰캣은 HTTP 서버를 자체 내장하기도 한다. 보통 톰캣은 WAS의 기능을 수행한다고 한다.

- 웹 서버와 WAS(웹 어플리케이션 서버 또는 컨테이너)의 차이

     

    웹 서버 : Web Client(웹 브라우저)에게 제공하는 컨텐츠를 제공하는 서버
                   정적인 HTML 혹은 jpeg나 gif같은 이미지를 HTTP프로토콜을 통해 
                   웹 브라우저로 제공
    WAS : Server단에서 어플리케이션을 동작할 수 있도록 지원
              일반적으로 컨테이너라는 용어로 사용됨
              Servlet, JSP, ASP, PHP 등의 프로그램으로 사용됨

    초기 웹은 이미지나 단순 HTML이었다면 현재는 동적인 요구에 대응하기 위해 이에 적합한 형태로 변화했다. (내부 어플리케이션을 동작시킬 수 있는 컨테이너를 내장)

    각 사이트가 많은 사용자에게 원활한 서비스를 제공하기 위해 기능적인 layer를 나누게 되면서 웹서버와 WAS의 구분이 나타나게 되었다.

    - 웹 서버 기능 
    1. Clustering 기능 : 사용자 요청이 발생하면 상황에 따라 각각의 WAS에 요청을 넘김.
    2. Cache 기능 : css, js, image 등의 리소스 파일을 가지고 있다가 WAS를 거치지 않고
                            사용자에게 직접 넘김. 사용자는 cache period동안 전달받은 리소스를 
                            사용한다.

    - WAS 기능
    ⇒ Servlet 페이지를 html 형태로 변환함
    ⇒ 예를 들어 jsp의 경우 jsp를 WAS에서 java class파일로 컴파일 후 html형태의 페이지를 
        사용자에게 전달하게 된다.

    ### 서블릿의 생명주기(Servlet Life Cycle)

    서블릿 생성 → init() → { service() → doXxx() } → destory() → 서블릿 종료 ( {} 반복 )

    서블릿 클래스 객체가 생성되면 가장 처음에 메서드 inint()이 실행되며, 클라이언트의 요청이 들어올 때마다 service() 메서드가 실행되어 요청에 맞는 doXxx()를 실행한다. 마지막으로 서버가 종료되거나 서블릿을 더 이상 사용할 필요가 없어 서블릿 객체를 메모리에서 제거할 때, 
    마지막으로  destoy()메서드가 실행되어 사용하던 자원을 정리하고 종료된다.
    init()과 destory()는 서블릿의 생성